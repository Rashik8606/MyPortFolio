{% extends 'base.html' %}
{% block content %}
<div class="container mx-auto px-6 py-16">
	<div class="max-w-6xl mx-auto">
		<!-- Header Section -->
		<div class="text-center mb-12">
			<div class="inline-flex items-center gap-3 mb-4">
				<div class="w-12 h-12 rounded-full bg-gradient-to-r from-primary to-fuchsia-500 flex items-center justify-center">
					<span class="text-white text-xl">📬</span>
				</div>
				<h1 class="text-4xl font-bold bg-gradient-to-r from-primary to-fuchsia-500 bg-clip-text text-transparent">
					Message Center
				</h1>
			</div>
			<p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
				Manage and respond to messages from your portfolio visitors
			</p>
		</div>

		<!-- Stats Cards -->
		{% if messages %}
		<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
			<div class="p-6 rounded-2xl bg-gradient-to-r from-blue-500 to-blue-600 text-white">
				<div class="flex items-center justify-between">
					<div>
						<p class="text-blue-100 text-sm">Total Messages</p>
						<p class="text-3xl font-bold">{{ messages|length }}</p>
					</div>
					<div class="text-4xl opacity-80">📧</div>
				</div>
			</div>
			<div class="p-6 rounded-2xl bg-gradient-to-r from-green-500 to-green-600 text-white">
				<div class="flex items-center justify-between">
					<div>
						<p class="text-green-100 text-sm">This Week</p>
						<p class="text-3xl font-bold">{{ messages|length }}</p>
					</div>
					<div class="text-4xl opacity-80">📈</div>
				</div>
			</div>
			<div class="p-6 rounded-2xl bg-gradient-to-r from-purple-500 to-purple-600 text-white">
				<div class="flex items-center justify-between">
					<div>
						<p class="text-purple-100 text-sm">Unique Senders</p>
						<p class="text-3xl font-bold">{{ messages|length }}</p>
					</div>
					<div class="text-4xl opacity-80">👥</div>
				</div>
			</div>
		</div>
		{% endif %}

		<!-- Search and Filter Bar -->
		<div class="mb-8 p-6 rounded-2xl bg-white/60 dark:bg-white/5 backdrop-blur border border-gray-200 dark:border-gray-800">
			<div class="flex flex-col md:flex-row gap-4 items-center justify-between">
				<div class="flex-1 max-w-md">
					<input type="text" id="searchInput" placeholder="Search messages..." 
						   class="w-full px-4 py-3 rounded-xl bg-gray-100 dark:bg-gray-800 outline-none focus:ring-2 ring-primary">
				</div>
				<div class="flex gap-2">
					<select id="sortSelect" class="px-4 py-3 rounded-xl bg-gray-100 dark:bg-gray-800 outline-none focus:ring-2 ring-primary">
						<option value="newest">Newest First</option>
						<option value="oldest">Oldest First</option>
						<option value="name">By Name</option>
					</select>
					<a href="/" class="px-6 py-3 rounded-xl bg-primary text-white hover:bg-primary/90 transition flex items-center gap-2">
						<span>←</span> Back to Portfolio
					</a>
				</div>
			</div>
		</div>
		
		<!-- Messages Grid -->
		{% if messages %}
			<div id="messagesContainer" class="space-y-6">
				{% for message in messages %}
				<div class="message-card p-6 rounded-2xl bg-white/60 dark:bg-white/5 backdrop-blur border border-gray-200 dark:border-gray-800 hover:shadow-xl hover:-translate-y-1 transition-all duration-300" 
					 data-name="{{ message.name|lower }}" 
					 data-email="{{ message.email|lower }}" 
					 data-message="{{ message.message|lower }}"
					 data-date="{{ message.created_at.isoformat() }}">
					
					<!-- Message Header -->
					<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4">
						<div class="flex items-center gap-4">
							<div class="w-12 h-12 rounded-full bg-gradient-to-r from-primary to-fuchsia-500 flex items-center justify-center text-white font-bold text-lg">
								{{ message.name[0].upper() }}
							</div>
							<div>
								<h3 class="font-semibold text-xl">{{ message.name }}</h3>
								<p class="text-primary font-medium">{{ message.email }}</p>
							</div>
						</div>
						<div class="flex items-center gap-3">
							<span class="px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-800 text-sm text-gray-600 dark:text-gray-400">
								{{ message.created_at.strftime('%B %d, %Y') }}
							</span>
							<span class="px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-800 text-sm text-gray-600 dark:text-gray-400">
								{{ message.created_at.strftime('%I:%M %p') }}
							</span>
						</div>
					</div>

					<!-- Message Content -->
					<div class="mt-4 p-6 rounded-xl bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800/50 dark:to-gray-900/50 border border-gray-200 dark:border-gray-700">
						<p class="text-gray-700 dark:text-gray-300 whitespace-pre-wrap leading-relaxed">{{ message.message }}</p>
					</div>

					<!-- Action Buttons -->
					<div class="mt-6 flex gap-3">
						<a href="mailto:{{ message.email }}?subject=Re: Your message from portfolio&body=Hi {{ message.name }},%0D%0A%0D%0AThank you for reaching out through my portfolio.%0D%0A%0D%0AYour message: {{ message.message }}%0D%0A%0D%0ABest regards,%0D%0AMuhammed Rashik" 
						   class="px-4 py-2 rounded-lg bg-green-500 text-white hover:bg-green-600 transition flex items-center gap-2">
							<span>📧</span> Reply
						</a>
						<button onclick="copyEmail('{{ message.email }}')" 
								class="px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600 transition flex items-center gap-2">
							<span>📋</span> Copy Email
						</button>
						<button onclick="markAsRead({{ message.id }})" 
								class="px-4 py-2 rounded-lg bg-gray-500 text-white hover:bg-gray-600 transition flex items-center gap-2">
							<span>✓</span> Mark Read
						</button>
					</div>
				</div>
				{% endfor %}
			</div>
		{% else %}
			<div class="text-center py-20">
				<div class="text-8xl mb-6">📭</div>
				<h2 class="text-3xl font-bold mb-4">No messages yet</h2>
				<p class="text-gray-600 dark:text-gray-400 text-lg max-w-md mx-auto mb-8">
					Contact messages will appear here when visitors send them through your portfolio.
				</p>
				<a href="/" class="inline-block px-6 py-3 rounded-xl bg-primary text-white hover:bg-primary/90 transition">
					View Portfolio
				</a>
			</div>
		{% endif %}
	</div>
</div>

<script>
// Search functionality
document.getElementById('searchInput').addEventListener('input', function() {
	const searchTerm = this.value.toLowerCase();
	const messageCards = document.querySelectorAll('.message-card');
	
	messageCards.forEach(card => {
		const name = card.dataset.name;
		const email = card.dataset.email;
		const message = card.dataset.message;
		
		if (name.includes(searchTerm) || email.includes(searchTerm) || message.includes(searchTerm)) {
			card.style.display = 'block';
		} else {
			card.style.display = 'none';
		}
	});
});

// Sort functionality
document.getElementById('sortSelect').addEventListener('change', function() {
	const sortBy = this.value;
	const container = document.getElementById('messagesContainer');
	const cards = Array.from(container.children);
	
	cards.sort((a, b) => {
		switch(sortBy) {
			case 'newest':
				return new Date(b.dataset.date) - new Date(a.dataset.date);
			case 'oldest':
				return new Date(a.dataset.date) - new Date(b.dataset.date);
			case 'name':
				return a.dataset.name.localeCompare(b.dataset.name);
			default:
				return 0;
		}
	});
	
	cards.forEach(card => container.appendChild(card));
});

// Copy email function
function copyEmail(email) {
	navigator.clipboard.writeText(email).then(() => {
		alert('Email copied to clipboard!');
	});
}

// Mark as read function
function markAsRead(messageId) {
	// This would typically make an API call to mark the message as read
	alert('Message marked as read!');
}
</script>
{% endblock %}
